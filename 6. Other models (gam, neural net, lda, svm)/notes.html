<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Other Supervised Learning Methods</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Other Supervised Learning Methods</h1>

<p>This tutorial helps you to review various supervised learning techniques, introduce GAM, Neural Networks models, etc., and prepare you to finish Case Study 1.</p>

<hr/>

<h2><a id="content"></a> Content </h2>

<h3><a href="#data">Credit Score Data</a></h3>

<h3><a href="#glm">Generalized Linear Models</a></h3>

<h3><a href="#tree">Tree Models (omitted)</a></h3>

<h3><a href="#gam">Generalized Additive Models (GAM)</a></h3>

<h3><a href="#da">Discriminant Analysis</a></h3>

<h3><a href="#nnet">Neural Networks Models</a></h3>

<h3><a href="#svm">SVM</a></h3>

<h3><a href="#compare">Performance Comparisons</a></h3>

<h3><a href="#german">Starter Code for German Credit Score</a></h3>

<hr/>

<h3><a id="data"></a>Credit Score Data <a id="data"></a></h3>

<h4>Load Data</h4>

<pre><code class="r">credit.data &lt;- read.csv(&quot;http://homepages.uc.edu/~maifg/7040/credit0.csv&quot;, header = T)
</code></pre>

<p>We remove X9 and id from the data since we will not be using them for prediction.</p>

<pre><code class="r">credit.data$X9 = NULL
credit.data$id = NULL
credit.data$Y = as.factor(credit.data$Y)
</code></pre>

<p>Now split the data 90/10 as training/testing datasets:</p>

<pre><code class="r">subset &lt;- sample(nrow(credit.data), nrow(credit.data) * 0.9)
credit.train = credit.data[subset, ]
credit.test = credit.data[-subset, ]
</code></pre>

<p>The training dataset has 61 variables, 4500 obs. </p>

<p>You are already familiar with the credit scoring set. Let&#39;s define a cost function for benchmarking testing set performance. Note this is slightly different from the one we used for searching for optimal cut-off probability in logistic regression. Here the 2nd argument is the predict class instead of the predict probability (since many methods are not based on predict probability).</p>

<pre><code class="r">creditcost &lt;- function(observed, predicted) {
    weight1 = 10
    weight0 = 1
    c1 = (observed == 1) &amp; (predicted == 0)  #logical vector - true if actual 1 but predict 0
    c0 = (observed == 0) &amp; (predicted == 1)  #logical vecotr - true if actual 0 but predict 1
    return(mean(weight1 * c1 + weight0 * c0))
}
</code></pre>

<h3><a id="glm"></a> Generalized Linear Models (Logistic Regression)</h3>

<p>Let&#39;s build a logistic regression model based on all X variables. Note id is excluded from the model.</p>

<pre><code class="r">credit.glm0 &lt;- glm(Y ~ ., family = binomial, credit.train)
</code></pre>

<p>You can view the result of the estimation:</p>

<pre><code class="r">summary(credit.glm0)
</code></pre>

<p>The usual stepwise variable selection still works for logistic regression. <strong>caution: this will take a very long time</strong>.</p>

<pre><code class="r">credit.glm.step &lt;- step(credit.glm0, direction = c(&quot;both&quot;))
</code></pre>

<p>Or you can try model selection with BIC:</p>

<pre><code class="r">credit.glm.step &lt;- step(credit.glm0, k = log(nrow(credit.train)), direction = c(&quot;both&quot;))
</code></pre>

<p>Are there better ways of doing variable selection for genearlized linear models? Yes! (And you should probably know about it.) Check the optional lab notes on <em>Lasso variable selection</em> and Section 3.4 of the textbook &ldquo;Elements of Statistical Learning&rdquo;.</p>

<p>If you want a sneak peek on how to use Lasso for this dataset here it is:</p>

<pre><code class="r">install.packages(&quot;glmnet&quot;)
</code></pre>

<pre><code class="r">library(glmnet)
</code></pre>

<pre><code>## Loading required package: Matrix
## Loading required package: lattice
## Loaded glmnet 1.9-5
</code></pre>

<pre><code class="r">lasso_fit = glmnet(x = as.matrix(credit.train[, 2:61]), y = credit.train[, 1], 
    family = &quot;binomial&quot;, alpha = 1)
coef(lasso_fit, s = 0.02)
</code></pre>

<pre><code>## 61 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                   1
## (Intercept) -2.4785
## X2           .     
## X3           .     
## X4           .     
## X5           .     
## X6           .     
## X7           .     
## X8          -0.2931
## X10_2        .     
## X11_2       -0.3386
## X12_2        .     
## X13_2        .     
## X14_2        .     
## X15_2        .     
## X15_3        .     
## X15_4        .     
## X15_5        .     
## X15_6        .     
## X16_2        .     
## X16_3        .     
## X16_4        .     
## X16_5        .     
## X16_6        .     
## X17_2        .     
## X17_3        .     
## X17_4        .     
## X17_5        .     
## X17_6       -0.0470
## X18_2        .     
## X18_3        .     
## X18_4        .     
## X18_5        .     
## X18_6        .     
## X18_7        .     
## X19_2        .     
## X19_3        .     
## X19_4        .     
## X19_5        .     
## X19_6        .     
## X19_7        .     
## X19_8        .     
## X19_9        .     
## X19_10       .     
## X20_2        .     
## X20_3        .     
## X20_4        .     
## X21_2        .     
## X21_3        .     
## X22_2        .     
## X22_3        .     
## X22_4        .     
## X22_5        .     
## X22_6        .     
## X22_7        .     
## X22_8        .     
## X22_9        .     
## X22_10       .     
## X22_11       .     
## X23_2        .     
## X23_3        .     
## X24_2        .
</code></pre>

<p>The <em>s</em> parameter determines how many variables are included and you can use cross-validation to choose it.</p>

<h4>Prediction and Cross Validation Using Logistic Regression</h4>

<h5>Performance on testing set</h5>

<p>To do out-of-sample prediction you need to add the testing set as a second argument after the glm object. Remember to add type = &ldquo;response&rdquo;, otherwise you will get the log odds and not the probability.</p>

<pre><code class="r">prob.glm0.outsample &lt;- predict(credit.glm0, credit.test, type = &quot;response&quot;)
predicted.glm0.outsample &lt;- prob.glm0.outsample &gt; 0.2
predicted.glm0.outsample &lt;- as.numeric(predicted.glm0.outsample)
table(credit.test$Y, predicted.glm0.outsample, dnn = c(&quot;Truth&quot;, &quot;Predicted&quot;))
</code></pre>

<pre><code>##      Predicted
## Truth   0   1
##     0 448  20
##     1  23   9
</code></pre>

<pre><code class="r">mean(ifelse(credit.test$Y != predicted.glm0.outsample, 1, 0))
</code></pre>

<pre><code>## [1] 0.086
</code></pre>

<pre><code class="r">creditcost(credit.test$Y, predicted.glm0.outsample)
</code></pre>

<pre><code>## [1] 0.5
</code></pre>

<h4>ROC Curve</h4>

<p>To get the ROC curve you need to install the verification library.</p>

<pre><code class="r">install.packages(&quot;verification&quot;)
</code></pre>

<p>To plot the ROC curve, the first argument of roc.plot is the vector with actual values &ldquo;A binary observation (coded {0, 1 } )&rdquo;. The second argument is the vector with predicted probability. </p>

<pre><code class="r">library(&quot;verification&quot;)
</code></pre>

<pre><code class="r">roc.plot(credit.test$Y == &quot;1&quot;, prob.glm0.outsample)
</code></pre>

<p>To get the area under the ROC curve:</p>

<pre><code class="r">roc.plot(credit.test$Y == &quot;1&quot;, prob.glm0.outsample)$roc.vol
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAABGlBMVEX9/v0AAAAAACAAADkAAGUAKDkAKI8AOSgAOTkAOWUAOY8ATIcAWGYAZrURACsfK0wgIAAiABcoAGUrAAArACsrK1wxOY85AAA5ADk5AGU5KAA5MVE5OQA5OWU5OXs5OY85e3s5j9o+KABIAFdIAGVItf1MACtMAEJMK2tXAABcKytlAABlAChlADllAEhlAGVlOQBlOY9lZjllZmVltbVltf1mOQBmOTlmWABro757HAB7OWV72/2HNgCPOQCPOTmPOWWPZgCPj2WPtY+P27WP29qP2/2cjzmjayujvr61ZgC1/rW1/tq1/v2+h0y+o2u+voe+vqO+vr7ajznatWXa24/a/rXa/v39tWX924/929r9/rX9/tr9/v2nzmIeAAAAXnRSTlP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AscguJgAAAAlwSFlzAAALEgAACxIB0t1+/AAADidJREFUeJztXYt/4zgRXtOFgx7hcTzaOziW8DgevWX3gADLo4VbCFygcCSwTUj8//8b6OXYiscaydZYcjrfr921x2PZ+qoZyaOx/KRkOPEk9Q3kDiYIAROEgAlCwAQhYIIQMEEImCAETBACJggBE4SACULABCFgghAwQQiYIARMEAImCAEThIAJQsAEIWCCEDBBCJggBIkJ2t8UEk/vq+3Lh6N4binNO8ugRR4ESV52V2rrYlmWWy2caR17b2wkJ0g2Hvnv4VZRsBJciU3RXjaKq7Ks9w63Qnl/IxUufl5cfNucMJNHi2JBc4fZELS7UtYl6r7Um4dbXeV6r0GQbHT/ke1ufyNoXKkmRmOEyQmq7GdrbGhVLLZWXeu9JkEzzaU4evmgKFQHCZAHQYsykCBlfRtxRKhXTkpbZGwkJ+jpvSBpXlmSr4kpMsTmG2mi506Q7L9k7Y9OWjNWOel6T6gsxMaRoHJ18XGDWxrkQJCotKYJ6+ZXZkhQESROURuVnOIOsyCocrrYQFFu/LI2MdPHl5oholbEjxoImCAETBACJggBE4SACULABCFgghAwQQiYIARMEAImCAET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" alt="plot of chunk unnamed-chunk-15"/> </p>

<pre><code>##      Model   Area   p.value binorm.area
## 1 Model  1 0.7956 1.084e-08          NA
</code></pre>

<p><a href="#content">go to top</a></p>

<hr/>

<h3><a id="gam"></a> Generalized Additive Models (GAM)</h3>

<p>There are two common implementations of GAMs in R.  The older version (originally made for S-PLUS) is available as the &#39;gam&#39; package by Hastie and Tibshirani.  The newer version that we will use below is the &#39;mgcv&#39; package from Simon Wood.  The basic modeling procedure for both packages is similar (the function is gam for both; be wary of having both libraries loaded at the same time), but the behind-the-scenes computational approaches differ, as do the arguments for optimization and the model output.  Expect the results to be slightly different when used with the same model structure on the same dataset.</p>

<pre><code class="r">library(mgcv)
</code></pre>

<pre><code>## Loading required package: nlme
## This is mgcv 1.7-27. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.
</code></pre>

<pre><code class="r">
## Create a formula for a model with a large number of variables:
gam_formula &lt;- as.formula(paste(&quot;Y~s(X2)+s(X3)+s(X4)+s(X5)+&quot;, paste(colnames(credit.train)[6:61], 
    collapse = &quot;+&quot;)))

credit.gam &lt;- gam(formula = gam_formula, family = binomial, data = credit.train)
summary(credit.gam)
</code></pre>

<pre><code>## 
## Family: binomial 
## Link function: logit 
## 
## Formula:
## Y ~ s(X2) + s(X3) + s(X4) + s(X5) + X6 + X7 + X8 + X10_2 + X11_2 + 
##     X12_2 + X13_2 + X14_2 + X15_2 + X15_3 + X15_4 + X15_5 + X15_6 + 
##     X16_2 + X16_3 + X16_4 + X16_5 + X16_6 + X17_2 + X17_3 + X17_4 + 
##     X17_5 + X17_6 + X18_2 + X18_3 + X18_4 + X18_5 + X18_6 + X18_7 + 
##     X19_2 + X19_3 + X19_4 + X19_5 + X19_6 + X19_7 + X19_8 + X19_9 + 
##     X19_10 + X20_2 + X20_3 + X20_4 + X21_2 + X21_3 + X22_2 + 
##     X22_3 + X22_4 + X22_5 + X22_6 + X22_7 + X22_8 + X22_9 + X22_10 + 
##     X22_11 + X23_2 + X23_3 + X24_2
## 
## Parametric coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -3.6205     0.7249   -4.99  5.9e-07 ***
## X6            0.1944     0.1135    1.71  0.08670 .  
## X7           -0.3993     0.2171   -1.84  0.06584 .  
## X8           -2.1339     0.3261   -6.54  6.0e-11 ***
## X10_2        -0.1985     0.1705   -1.16  0.24425    
## X11_2        -0.8503     0.1529   -5.56  2.7e-08 ***
## X12_2        -0.2691     0.2020   -1.33  0.18281    
## X13_2         0.2531     0.1593    1.59  0.11210    
## X14_2        -0.2935     0.2766   -1.06  0.28870    
## X15_2         0.6038     0.2435    2.48  0.01314 *  
## X15_3         0.2888     0.3009    0.96  0.33714    
## X15_4         0.9055     0.3252    2.78  0.00536 ** 
## X15_5         0.5527     0.4108    1.35  0.17848    
## X15_6         1.0302     0.2761    3.73  0.00019 ***
## X16_2         0.4486     0.2852    1.57  0.11578    
## X16_3        -0.0690     0.2846   -0.24  0.80848    
## X16_4         0.1178     0.3563    0.33  0.74089    
## X16_5        -0.2403     0.2880   -0.83  0.40395    
## X16_6         0.0790     0.2975    0.27  0.79044    
## X17_2        -0.1450     0.2586   -0.56  0.57502    
## X17_3        -1.2477     0.3232   -3.86  0.00011 ***
## X17_4        -0.3696     0.2719   -1.36  0.17405    
## X17_5         1.0502     0.4064    2.58  0.00977 ** 
## X17_6        -1.1063     0.1727   -6.40  1.5e-10 ***
## X18_2         0.1730     0.3376    0.51  0.60838    
## X18_3         0.3850     0.2701    1.43  0.15412    
## X18_4         0.9863     0.2558    3.86  0.00012 ***
## X18_5         0.7396     0.2379    3.11  0.00188 ** 
## X18_6         0.5235     0.2908    1.80  0.07181 .  
## X18_7         0.7009     0.3047    2.30  0.02144 *  
## X19_2         0.4054     0.3688    1.10  0.27160    
## X19_3         0.6073     0.3076    1.97  0.04832 *  
## X19_4        -0.2147     0.5703   -0.38  0.70657    
## X19_5         0.5003     0.4075    1.23  0.21952    
## X19_6         0.3828     0.4590    0.83  0.40427    
## X19_7         0.6882     0.4314    1.60  0.11066    
## X19_8        -0.8500     0.6792   -1.25  0.21076    
## X19_9         0.8234     0.5429    1.52  0.12934    
## X19_10        0.5143     0.3441    1.49  0.13505    
## X20_2         0.0331     0.3500    0.09  0.92463    
## X20_3        -0.1206     0.2701   -0.45  0.65520    
## X20_4         0.1164     0.1812    0.64  0.52047    
## X21_2         0.2894     0.4377    0.66  0.50841    
## X21_3         0.5360     0.2186    2.45  0.01420 *  
## X22_2        -0.4072     0.4127   -0.99  0.32377    
## X22_3         0.1710     0.3544    0.48  0.62945    
## X22_4        -0.0582     0.4596   -0.13  0.89929    
## X22_5        -0.1785     0.4533   -0.39  0.69384    
## X22_6         0.0938     0.5960    0.16  0.87499    
## X22_7         0.2589     0.3774    0.69  0.49275    
## X22_8         0.1413     0.3657    0.39  0.69915    
## X22_9         0.5946     0.3301    1.80  0.07164 .  
## X22_10       -1.1581     1.0832   -1.07  0.28501    
## X22_11        0.5051     0.3509    1.44  0.15007    
## X23_2        -0.0725     0.2114   -0.34  0.73146    
## X23_3        -0.1426     0.2259   -0.63  0.52784    
## X24_2         0.3810     0.3130    1.22  0.22347    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##        edf Ref.df Chi.sq p-value    
## s(X2) 1.00   1.00   2.26    0.13    
## s(X3) 1.00   1.00  18.04 2.2e-05 ***
## s(X4) 1.91   2.40   1.57    0.55    
## s(X5) 3.03   3.78   5.62    0.20    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =   0.12   Deviance explained = 18.7%
## UBRE score = -0.60454  Scale est. = 1         n = 4500
</code></pre>

<pre><code class="r">plot(credit.gam, shade = TRUE, , seWithMean = TRUE, scale = 0)
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAAe1BMVEX9/v0AAAAAADkAAGUAOTkAOY8AZrU5AAA5ADk5AGU5OY85ZrU5j9plAABlADllAGVlOY9lZmVlZrVltf2POQCPOTmPOWWPtY+P29qP2/21ZgC1ZmW1jzm1/rW1/tq1/v3MzMzajzna/tra/v39tWX924/9/rX9/tr9/v2NvvgNAAAAKXRSTlP/////////////////////////////////////////////////////AFL0IIcAAAAJcEhZcwAACxIAAAsSAdLdfvwAAA48SURBVHic7d0NV9tGFoDhmmySLQ3N7oamJfuRoWDQ//+FixRMYSRLmrl3Pu/7nj2H46WWR/NkJEXg+KeBTPZT6QFQmYA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3GvBGA95owBsNeKMBbzTgjQa80YA3mgT+QDWXEF7wXEod8EYD3mjAGw14owFvNOCNBrzRgDca8EYD3mjAGw14owFvJOc9Bt5GDniTOeBN5oA3mQPeZA54izkHvMUc8CZzwFvMOeAt5oA3mQPeYs4BbzLgbea7A2+jmTvwJpq7A2+hBXfgDbTkDnz3LbID331n3IHvvHPuwHfdWXbgu27FHfiOW3MHvttW2YHvtg134Dttyx34Ptt0B77Ltt2B77Ed7sB32B534LtrFzvw3bXTHfjO2usOfFftZge+qwLcge+oEHfguymIHfhuCnQHvpNC3YHvomB24PsIeJtFuAPfQTHuwLdflDvwzRfnDnzrRboD33ax7MC3Xbw78C0ncAe+3STswLebzB34VhO6A99mUnbg20zuDnyLKbgD32Aa7sC3l4q7Ovzx42Hs3ffZd4DXScddG/7x+sv09f79nf8t4FVScteGf/j8/c3X/ZumPWmxs+LbSs9d/Rz/cMU5PlmK7lzVt5MmO/DtpOueCv7Vxd3hVNBukpeyOyu+jbTZgW8jfXfgWyiBO/ANlMJd/c7d1fOV3Pwv8sBHlsRdfcU/Xn868x3g40rjrn+o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" alt="plot of chunk unnamed-chunk-16"/> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAAeFBMVEX9/v0AAAAAADkAAGUAOTkAOY8AZrU5AAA5ADk5AGU5OY85ZrU5j9plAABlADllAGVlOY9lZmVlZrVltf2POQCPOTmPOWWPtY+P29qP2/21ZgC1ZmW1/rW1/tq1/v3MzMzajzna/tra/v39tWX924/9/rX9/tr9/v1fpw3lAAAAKHRSTlP///////////////////////////////////////////////////8AvqouGAAAAAlwSFlzAAALEgAACxIB0t1+/AAADkJJREFUeJzt3Q9XG8cVhvGINHZDTNzWjhPTNlAQ6Pt/w7ICOzCSYOfPnXtn3uc5PSdVG69m9+eRVgva+WFHkv3gPQDyCXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNGAFw140YAXDXjRgBcNeNFq4DcUOUP4ij9L1gEvGvCiAS8a8KIBLxrwogEvGvCiAS8a8KIBLxrwovWDv7qq2Ba1ric88oHqCo98nPrCQx+m3vDIB6k7PPIx6g8PfYg84JEPkAs88v75wCPvnhM88t55wSPvnBs89L45wiPvmSc88o65wkPvlzM88l55wyPvlDs89D4FgIfeoxDw0PcvCDzyvYsCj3znauHvPv65u7vYbH66eWvTb8BD37cG8Iv9bvvLW5t+Ex75njWA357fPM781zf9NjzyHauGvzj748sy488PXuvz4aHvV/3J3f3nzbvd7Y8HE74IHvlehTmrR75v4eCh71Mr+GcndyfulroaHvoeBZzxyPcoJjzy5lXDb9/vX9ZbndUj36la+PvPn/b/vD28ZptsepMnD71tLa7VP//n6U1fbaAPVL8Z/yAJfZyq3+OXH82tf4/Ppc/ZFcqp+1l9Jn3F89NrOXycY9JHyONzPJM+QD4XcJB3z+nKHZPeO7dLtrzT++Z3rZ5Pdq55/pAGesd8fzoHvVveP5blLM8pb3g+2jnlD8+kdykAPB/tPAoBz6TvXwz4XPqKUdFjUeAz6SuGRfviwEPftUjw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" alt="plot of chunk unnamed-chunk-16"/> <img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-16"/> <img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-16"/> </p>

<p>Model AIC/BIC and mean residual deviance</p>

<pre><code class="r">AIC(credit.gam)
</code></pre>

<pre><code>## [1] 1780
</code></pre>

<pre><code class="r">BIC(credit.gam)
</code></pre>

<pre><code>## [1] 2190
</code></pre>

<pre><code class="r">credit.gam$deviance
</code></pre>

<pre><code>## [1] 1652
</code></pre>

<h4>In-sample fit performance</h4>

<pre><code class="r">pcut.gam &lt;- 0.08
prob.gam.in &lt;- predict(credit.gam, credit.train, type = &quot;response&quot;)
pred.gam.in &lt;- (prob.gam.in &gt;= pcut.gam) * 1
table(credit.train$Y, pred.gam.in, dnn = c(&quot;Observation&quot;, &quot;Prediction&quot;))
</code></pre>

<pre><code>##            Prediction
## Observation    0    1
##           0 3390  842
##           1  100  168
</code></pre>

<p>Misclassification rate is</p>

<pre><code class="r">mean(ifelse(credit.train$Y != pred.gam.in, 1, 0))
</code></pre>

<pre><code>## [1] 0.2093
</code></pre>

<p>Training model AIC and BIC</p>

<pre><code class="r">AIC(credit.gam)
</code></pre>

<pre><code>## [1] 1780
</code></pre>

<pre><code class="r">BIC(credit.gam)
</code></pre>

<pre><code>## [1] 2190
</code></pre>

<h4>Search for optimal cut-off probability</h4>

<p>The following code does a grid search from pcut = 0.01 to pcut = 0.99 with the objective of minimizing overall cost in the training set. I am using an asymmetric cost function by assuming that giving out a bad loan cost 10 time as much as rejecting application from someone who can pay.</p>

<pre><code class="r"># define the searc grid from 0.01 to 0.20
searchgrid = seq(0.01, 0.2, 0.01)
# result.gam is a 99x2 matrix, the 1st col stores the cut-off p, the 2nd
# column stores the cost
result.gam = cbind(searchgrid, NA)
# in the cost function, both r and pi are vectors, r=truth, pi=predicted
# probability
cost1 &lt;- function(r, pi) {
    weight1 = 10
    weight0 = 1
    c1 = (r == 1) &amp; (pi &lt; pcut)  #logical vector - true if actual 1 but predict 0
    c0 = (r == 0) &amp; (pi &gt; pcut)  #logical vecotr - true if actual 0 but predict 1
    return(mean(weight1 * c1 + weight0 * c0))
}

for (i in 1:length(searchgrid)) {
    pcut &lt;- result.gam[i, 1]
    # assign the cost to the 2nd col
    result.gam[i, 2] &lt;- cost1(credit.train$Y, predict(credit.gam, type = &quot;response&quot;))
}
plot(result.gam, ylab = &quot;Cost in Training Set&quot;)
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAAflBMVEX9/v0AAAAAADkAAGUAOWUAOY8AZo8AZrU5AAA5ADk5AGU5OWU5OY85ZrU5j9plAABlADllAGVlOQBlOTllZgBltf2POQCPOTmPOWWPjzmPtY+P29qP2/21ZgC124+1/rW1/v3ajzna24/a/rXa/v39tWX924/9/rX9/tr9/v1CjQxqAAAAKnRSTlP//////////////////////////////////////////////////////wAyqPBcAAAACXBIWXMAAAsSAAALEgHS3X78AAALmElEQVR4nO3di3raRgJA4eLWazebmmy3ONkttCY1GN7/BSsJHOMguyNmxMxwzv9l1w5ppOBjXS2NftgK6Yfc/wDlYXgow0MZHsrwUIaHMjyU4aEMD2V4KMNDGR7K8FCGhzI8lOGhDA9leCjDQxkeyvBQhocyPJThoQwPZXgow0MZHsrwUIaHMjyU4aEMD2V4KMNDGR7K8FCGhzI8lOGhDA9leCjDQxkeyvBQhocyPJThoQwPZXgow0MZHsrwUIaHMjyU4aEMD2V4qJjwE5VsxPARf1djMzyU4aEMD2V4KMNDGR7K8FCGhzI81NnC/+NJQp3VucJP/nleOifDQxkeym08lHv1UIaHMjyU4aEMD2V4KMNDGR7K8FCGhzI8lOGhDA9leCjDQxkeyvBQhocyPJThoQwPZXgow0MZHio6/Pq2GzXtx4ehk1ZWseE397Pu4+r6ceCklVVs+Kf/PLz6GD5pZeUSDxW9jX+auo2vkXv1UIaHit65m96dOGllFb9X/7/J7KRJK6sUh3OLvl07w5ctzXF8s2t/3N7wJUt1AudwkmEPv1BW7tVDGR4qVXjP1VfGJR7K8FBeiAHlj2WhvBADyiUeygsxoNyrhzI8lOGhDA9leCjDQxkeyvBQhocyPJThoQwPZXgow0MZHsrwUIaHMjyU4aEMD2V4KMNDGR7K8FCGhzI8lOGhDA9leCjDQ6UYGKG9U/r49njDFy1B+G4wjPUvQyetrBKEX398dCiU6sSPV3/1+5d2if/oUChVid+529xPbrYrh0KpjHv1UIaHSjCy5axZ2Xs4V5sU49wtZu7cVSfB4dzm89zDuepEr+qbxX11t92uboZOWlnF79wtupEtD7r7TJoa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" alt="plot of chunk unnamed-chunk-21"/> </p>

<pre><code class="r">index.min &lt;- which.min(result.gam[, 2])  #find the index of minimum value
result.gam[index.min, 2]  #min cost
</code></pre>

<pre><code>##        
## 0.4062
</code></pre>

<pre><code class="r">result.gam[index.min, 1]  #optimal cutoff probability
</code></pre>

<pre><code>## searchgrid 
##       0.11
</code></pre>

<h4>Out-of-sample fit performance</h4>

<pre><code class="r">pcut &lt;- result.gam[index.min, 1]
prob.gam.out &lt;- predict(credit.gam, credit.test, type = &quot;response&quot;)
pred.gam.out &lt;- (prob.gam.out &gt;= pcut) * 1
table(credit.test$Y, pred.gam.out, dnn = c(&quot;Observation&quot;, &quot;Prediction&quot;))
</code></pre>

<pre><code>##            Prediction
## Observation   0   1
##           0 412  56
##           1  17  15
</code></pre>

<p>mis-classifciation rate is</p>

<pre><code class="r">mean(ifelse(credit.test$Y != pred.gam.out, 1, 0))
</code></pre>

<pre><code>## [1] 0.146
</code></pre>

<p>Cost associated with misclassification is</p>

<pre><code class="r">creditcost(credit.test$Y, pred.gam.out)
</code></pre>

<pre><code>## [1] 0.452
</code></pre>

<p><a href="#content">go to top</a></p>

<hr/>

<h3><a id="da"></a> Discriminant Analysis</h3>

<p>Linear Discriminant Analysis (LDA) (in-sample and out-of-sample performance measure) is illustrated here. The following illustrate the usage of an arbitrary cut off probability.</p>

<h4>In-sample</h4>

<pre><code class="r">credit.train$Y = as.factor(credit.train$Y)
credit.lda &lt;- lda(Y ~ ., data = credit.train)
prob.lda.in &lt;- predict(credit.lda, data = credit.train)
pcut.lda &lt;- 0.15
pred.lda.in &lt;- (prob.lda.in$posterior[, 2] &gt;= pcut.lda) * 1
table(credit.train$Y, pred.lda.in, dnn = c(&quot;Obs&quot;, &quot;Pred&quot;))
</code></pre>

<pre><code>##    Pred
## Obs    0    1
##   0 3917  315
##   1  157  111
</code></pre>

<pre><code class="r">mean(ifelse(credit.train$Y != pred.lda.in, 1, 0))
</code></pre>

<pre><code>## [1] 0.1049
</code></pre>

<h4>Out-of-sample</h4>

<pre><code class="r">lda.out &lt;- predict(credit.lda, newdata = credit.test)
cut.lda &lt;- 0.12
pred.lda.out &lt;- as.numeric((lda.out$posterior[, 2] &gt;= cut.lda))
table(credit.test$Y, pred.lda.out, dnn = c(&quot;Obs&quot;, &quot;Pred&quot;))
</code></pre>

<pre><code>##    Pred
## Obs   0   1
##   0 423  45
##   1  19  13
</code></pre>

<pre><code class="r">mean(ifelse(credit.test$Y != pred.lda.out, 1, 0))
</code></pre>

<pre><code>## [1] 0.128
</code></pre>

<pre><code class="r">creditcost(credit.test$Y, pred.lda.out)
</code></pre>

<pre><code>## [1] 0.47
</code></pre>

<p><a href="#content">go to top</a></p>

<hr/>

<h3><a id="nnet"></a> Neural Networks Models</h3>

<p>Neural Networks method (in-sample and out-of-sample performance measure) is illustrated here. The package <a href="http://cran.r-project.org/web/packages/nnet/nnet.pdf"><strong>nnet</strong></a> is used for this purpose.</p>

<p><strong>Note</strong>: </p>

<ul>
<li>For classification problems with nnet you need to code the response to <em>factor</em> first. In addition you want to add type = &ldquo;class&rdquo; for <em>predict()</em>  function. </li>
<li>For regression problems add lineout = TRUE when training model</li>
</ul>

<pre><code class="r">Boston.nnet &lt;- nnet(medv ~ ., size = 4, data = Boston, linout = TRUE)
</code></pre>

<h4>Training</h4>

<pre><code class="r">library(nnet)
</code></pre>

<pre><code class="r">credit.nnet &lt;- nnet(Y ~ ., data = credit.train, size = 1, maxit = 500)
</code></pre>

<pre><code>## # weights:  63
## initial  value 3140.611280 
## iter  10 value 1003.636297
## iter  20 value 932.425511
## iter  30 value 887.965726
## iter  40 value 878.059629
## iter  50 value 868.658010
## iter  60 value 865.843951
## iter  70 value 865.596583
## iter  80 value 865.584414
## final  value 865.583442 
## converged
</code></pre>

<h4>Out-of-sample Testing</h4>

<pre><code class="r">prob.nnet = predict(credit.nnet, credit.test)
pred.nnet = as.numeric(prob.nnet &gt; 0.08)
table(credit.test$Y, pred.nnet, dnn = c(&quot;Observation&quot;, &quot;Prediction&quot;))
</code></pre>

<pre><code>##            Prediction
## Observation   0   1
##           0 411  57
##           1  17  15
</code></pre>

<pre><code class="r">mean(ifelse(credit.test$Y != pred.nnet, 1, 0))
</code></pre>

<pre><code>## [1] 0.148
</code></pre>

<pre><code class="r">creditcost(credit.test$Y, pred.nnet)
</code></pre>

<pre><code>## [1] 0.454
</code></pre>

<p><a href="#content">go to top</a></p>

<h3><a id="svm"></a> Support Vector Machine (SVM)</h3>

<p>SVM is probably one of the best off-the-shelf classifiers for many of problems. It handles nonlinearity, is well regularized (avoids overfitting), have few parameters, and fast for large number of observations. It can be adapted to handle regression problems as well. You can read more about SVM in Chapter 12 of the textbook. </p>

<p>The R package e1071 offers an interface to the most popular svm implementation libsvm. You should read more about the usage of the package in this short tutorial (<a href="http://cran.r-project.org/web/packages/e1071/vignettes/svmdoc.pdf">http://cran.r-project.org/web/packages/e1071/vignettes/svmdoc.pdf</a>).</p>

<pre><code class="r">install.packages(&quot;e1071&quot;)
</code></pre>

<pre><code class="r">library(e1071)
</code></pre>

<pre><code>## Loading required package: class
</code></pre>

<pre><code class="r">credit.svm = svm(Y ~ ., data = credit.train, cost = 1, gamma = 1/length(credit.train), 
    probability = TRUE)
prob.svm = predict(credit.svm, credit.test, probability = TRUE)
prob.svm = attr(prob.svm, &quot;probabilities&quot;)[, 2]  #This is needed because prob.svm gives a 
pred.svm = as.numeric((prob.svm &gt;= 0.08))
table(credit.test$Y, pred.svm, dnn = c(&quot;Obs&quot;, &quot;Pred&quot;))
</code></pre>

<pre><code>##    Pred
## Obs   0   1
##   0 401  67
##   1  15  17
</code></pre>

<pre><code class="r">mean(ifelse(credit.test$Y != pred.svm, 1, 0))
</code></pre>

<pre><code>## [1] 0.164
</code></pre>

<pre><code class="r">creditcost(credit.test$Y, pred.svm)
</code></pre>

<pre><code>## [1] 0.434
</code></pre>

<p>credit.svm = svm(Y ~ ., data = credit.train, cost = 1, gamma = 1/length(credit.train), probability= TRUE)
prob.svm = predict(credit.svm, credit.test)</p>

<p><a href="#content">go to top</a></p>

<h3><a id="compare"></a> Performance Comparisons</h3>

<p>At last, after fitting several models, you may want to compare their in-sample and out-of-sample performances. The performance measures are illustrated in previous sections. In your report, you may want to put them in some table format. Note that not all measures are applicable. For example, I didn&#39;t find AIC/BIC or deviance for LDA models and Neural Network models. For tree models, <em>tree</em> package can give you mean residual deviance but not with <em>rpart</em> package. If you find either one of them, I would be interested to know.</p>

<h4>In-sample</h4>

<p>You may compare the following</p>

<ul>
<li>AIC or BIC</li>
<li>Mean Residual Deviance (for binary response) or Mean Square Error (for continuous response)</li>
<li>Cost (asymmetric or symmetric)</li>
<li>Misclassification Rate</li>
<li>ROC curve or Area Under the Curve (AUC)</li>
</ul>

<h4>Out-of-sample</h4>

<ul>
<li>Cost</li>
<li>Misclassification Rate</li>
<li>ROC curve or Area Under the Curve (AUC)</li>
</ul>

<h4>Symmetric Cost and Multiclass Problems</h4>

<p>For classification tasks with symmetric costs many of functions can be simplified. You do not have to worry about the cut-off probability and can focus on the tuning parameters in each model (e.g. cost and gamma in SVM).</p>

<p>Different classifiers deal with multiclass classification differently. Logistic regression can be extended to multinomial logistic regression (using <em>multinom</em> function). Many other binary classifiers can use an either &ldquo;one-vs-all&rdquo;(train N binary classifiers to distinguish each class from the rest) or &ldquo;one-vs-one&rdquo;(train C(N,2) binary classifiers for each possible pair of classes) approach to deal with multiple classes. </p>

<pre><code class="r">data(iris)
subset &lt;- sample(nrow(iris), nrow(iris) * 0.8)
iris.train = iris[subset, ]
iris.test = iris[-subset, ]
iris.svm = svm(Species ~ ., data = iris.train)
table(iris.test$Species, predict(iris.svm, iris.test), dnn = c(&quot;Obs&quot;, &quot;Pred&quot;))
</code></pre>

<pre><code>##             Pred
## Obs          setosa versicolor virginica
##   setosa         11          0         0
##   versicolor      0         10         0
##   virginica       0          1         8
</code></pre>

<p><a href="#content">go to top</a></p>

<h3><a id="german"></a> Starter code for German credit scoring</h3>

<p>Refer to <a href="http://archive.ics.uci.edu/ml/datasets/Statlog+(German+Credit+Data)">http://archive.ics.uci.edu/ml/datasets/Statlog+(German+Credit+Data)</a>) for variable description. Notice that &ldquo;It is worse to class a customer as good when they are bad (weight = 5), than it is to class a customer as bad when they are good (weight = 1).&rdquo; Define your cost function accordingly!</p>

<pre><code class="r">install.packages(&quot;caret&quot;)
</code></pre>

<pre><code class="r">library(caret)  #this package contains the german data with its numeric format
data(GermanCredit)
</code></pre>

<p><a href="#content">go to top</a></p>

</body>

</html>

